# PyBOM

![Tests](https://github.com/robsiegwart/pyBOM/actions/workflows/test.yml/badge.svg)

A Python program for flattening a layered bill-of-material (BOM) based on Excel
files. Part quantities are combined and a total quantity or
minimum-required-package-to-buy amount is calculated, in addition to extended
costs. A tree structure of the BOM hierarchy can also be created and converted
to DOT syntax for further graphics generation.

## Motivation

The main problem solved is to combine identical parts from various
sub-assemblies and locations in your product BOM. Additionally, it is to be used
with Excel since Excel is common, easy, and does not require a separate program
or server to run. Flattening tells you the total QTY of a part when it may be
used in many sub-assemblies and levels in your product structure. This is
necessary to calculate the total QTY of a part and therefore determine the
mininum packages of the product to buy, since many parts come in packs greater
than QTY 1.

## Structure

There are two methods for storing data for parts and assemblies: multi-file or
single file.

### Multi-File

In a separate directory, put an Excel file named *Parts List.xlsx* to serve as
the master parts list \"database\". Then, each additional assembly is described
by a separate .xlsx file. Thus you might have:

    my_project/
       Parts list.xlsx     <-- master parts list
       SKA-100.xlsx        <-- top level/root assembly
       TR-01.xlsx          <-- subassembly
       WH-01.xlsx          <-- subassembly

Root and sub-assemblies are inferred from item number relationships and do not
have to be explicitly identified.

*Parts list.xlsx* serves as the single point of reference for part information.
For example, it may have the following:

| PN        | Name        | Description                    | Supplier               | Supplier PN   | Pkg QTY   | Pkg Price  | Item  |
| --------- | ----------- | ------------------------------ | ---------------------- | ------------- | --------- | ---------- | ----- |
| SK1001-01 | Deck        | Pavement Pro 9" Maple Deck     | Grindstone Supply Co.  | BRX-02        | 1         | 67.95      | part  |
| SK1002-01 | Truck       | HollowKing Standard Trucks     | Grindstone Supply Co.  | TR1-A         | 1         | 28.95      | part  |
| SK1003-01 | Bearing     | ABEC-7 Steel Bearings          | BoltRun Hardware       | 74295-942     | 1         | 9.95       | part  |
| SK1004-01 | Wheel       | SlickCore 54mm Cruiser Wheels  | Grindstone Supply Co.  | WHL-PRX       | 4         | 44.95      | part  |
| SK1005-01 | Screw       | 10-32, 1", Phillips            | BoltRun Hardware       | 92220A        | 25        | 12.49      | part  |
| SK1006-01 | Nut         | 10-32                          | BoltRun Hardware       | 95479A        | 25        | 9.89       | part  |
| SK1007-01 | Grip Tape   | SuperStick 9"                  | BoltRun Hardware       | GTSS99        | 1         | 8.95       | part  |

For each assembly, all that is required is the part identification number and
quantity which correspond to the following fields:

- PN
- QTY

Example wheel assembly (1 wheel + 2 bearings):

| PN          | QTY   |
| ----------- | ----- |
| SK1004-01   | 1     |
| SK1003-01   | 2     |

Certain fields are used in calculating totals, such as in `BOM.BOM.summary`,
which are:

`Pkg QTY`
  : The quantity of items in a specific supplier SKU (i.e. a bag of 100 screws)

`Pkg Price`
  : The cost of a specific supplier SKU                                        


### Single File

A single Excel file is used to store all part and assembly data through the use
of Excel tabs.

The first (left-most) Excel tab is treated as the Parts List "database", regardless
of its name. All tabs/sheets to the right are interpreted as assemblies, with
the sheet name as the assembly part number (PN).


## Usage

After downloading, install with pip via `pip install .`

Setup your data with either the multi-file or single file approach.

### API Usage

```python
from pybom import BOM

# Multi-file
bom = BOM.from_folder(FOLDER)

# Single file
bom = BOM.single_file(FILENAME)
```

This returns a `BOM` object with properties on it you can retrieve:


`BOM.parts`
  : Get a list of all direct-child parts

  ```
  >>> print(bom.parts)
  [Part SK1001-01, Part SK1005-01, Part SK1006-01, Part SK1007-01] 
  ```

`BOM.assemblies`
  : Get a list of all direct-child assemblies

  ```
  >>> print(bom.assemblies)
  [WH-01, TR-01]
  ```

`BOM.aggregate`
  : Get the aggregated quantity of each part/assembly from the current
  BOM level down

  ```
  >>> print(bom.aggregate)
  {'SK1001-01': 1, 'SK1005-01': 8, 'SK1006-01': 8, 'SK1007-01': 1, 'SK1004-01': 8, 'SK1003-01': 16, 'SK1002-01': 2}
  ```

`BOM.summary`
  : Get a summary in the form of a DataFrame containing the master parts
  list with each item's aggregated quantity and the required packages
  to buy if the `Pkg QTY` field is not 1.

  ```
  >>> print(bom.summary)
          PN       Name                    Description  ... Total QTY Purchase QTY  Subtotal
0  SK1001-01       Deck     Pavement Pro 9" Maple Deck  ...         1            1     67.95
1  SK1002-01      Truck     HollowKing Standard Trucks  ...         2            2     57.90
2  SK1003-01    Bearing          ABEC-7 Steel Bearings  ...        16           16     55.84
3  SK1004-01      Wheel  SlickCore 54mm Cruiser Wheels  ...         8            1     44.95
4  SK1005-01      Screw            10-32, 1”, Phillips  ...         8            1     12.49
5  SK1006-01        Nut                          10-32  ...         8            1      9.89
6  SK1007-01  Grip tape                  SuperStick 9”  ...         1            1      8.95
  ```

`BOM.tree`
  : Return a string representation of the BOM tree hierarchy

  ```
  >>> print(bom.tree)
  SKA-100
  ├── Part SK1001-01        
  ├── TR-01
  │   ├── Part SK1002-01    
  │   └── WH-01
  │       ├── Part SK1004-01
  │       └── Part SK1003-01
  ├── Part SK1005-01        
  ├── Part SK1006-01        
  └── Part SK1007-01  
  ```

  Calling this on child assemblies shows the tree from that reference point:
  ```
  >>> sa = bom.assemblies[0]
  >>> sa
  WH-01
  >>> print(sa.tree)
  WH-01
  ├── Part SK1004-01
  ├── Part SK1003-01
  ```

### Command Line Usage

Functionality is extended to the command line via the command `pybom`, where the
flag `-f` or `-d` is used to specify the name of a file for single-file mode
or a folder for multi-file mode.

`action` is what to do with the imported data, which just maps to a property
on the top-level `BOM` object.

```
> pybom [-h] (-f FILE | -d FOLDER) action
```

```
> pybom -d Example tree
SKA-100
├── Part SK1001-01        
├── TR-01
│   ├── Part SK1002-01    
│   └── WH-01
│       ├── Part SK1004-01
│       └── Part SK1003-01
├── Part SK1005-01        
├── Part SK1006-01        
└── Part SK1007-01 
```

Dependencies
------------

- *pandas*
- *anytree*